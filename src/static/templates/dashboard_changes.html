{% extends "dashboard_base.html" %}

{% block title %}Request Changes - {{ super() }}{% endblock %}

{% block dashboard_title %}Request Changes{% endblock %}

{% block dashboard_content %}
<div class="request-changes">
    <div class="intro-section">
        <p>Need updates or changes to your website? Use this form to submit your request.</p>
        <p><strong>Note:</strong> Minor text updates and image changes are included in your subscription. More substantial changes may incur additional fees.</p>
    </div>

    <div class="change-request-form">
        <form action="{{ url_for('user.submit_change_request') }}" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            
            <div class="form-group">
                <label for="website_id">Select Website:</label>
                <select id="website_id" name="website_id" required>
                    <option value="">-- Select Website --</option>
                    {% for website in websites %}
                        <option value="{{ website.id }}" {% if selected_website_id == website.id %}selected{% endif %}>
                            {{ website.template.name }} ({{ website.created_at.strftime('%Y-%m-%d') }})
                        </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label for="change_description">Describe the changes you need:</label>
                <textarea id="change_description" name="change_description" rows="6" required>{{ change_description }}</textarea>
                <p class="form-help">Please be as specific as possible. Include URLs of pages that need changes, exact text to be updated, etc.</p>
            </div>
            
            <div class="form-group">
                <label for="urgency">Urgency:</label>
                <select id="urgency" name="urgency">
                    <option value="normal">Normal (3-5 business days)</option>
                    <option value="high">High (1-2 business days)</option>
                    <option value="urgent">Urgent (24 hours)</option>
                </select>
                <p class="form-help">Higher urgency may incur additional fees.</p>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="cta-button">Submit Request</button>
            </div>
        </form>
    </div>

    {% if change_requests %}
        <div class="previous-requests">
            <h3>Previous Change Requests</h3>
            <table class="requests-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Website</th>
                        <th>Description</th>
                        <th>Status</th>
                        <th>Fee</th>
                    </tr>
                </thead>
                <tbody>
                    {% for request in change_requests %}
                        <tr>
                            <td>{{ request.created_at.strftime('%Y-%m-%d') }}</td>
                            <td>{{ request.order.template.name }}</td>
                            <td>{{ request.description|truncate(50) }}</td>
                            <td>{{ request.status|replace('_', ' ')|title }}</td>
                            <td>
                                {% if request.is_billable and request.fee %}
                                    ZAR {{ request.fee }}
                                {% else %}
                                    Included
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}
</div>
{% endblock %}
